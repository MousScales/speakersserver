<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speakers Server - Open Forum</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="animations.css">
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none; color: inherit;">
                    <h1>Speakers Server <span class="header-dash">-</span> <span class="header-quote-text">where opinions meet conversation</span></h1>
                </a>
            </div>
            <div class="header-actions">
                <a href="#" class="donate-btn" id="donateBtn">Donate</a>
                <button class="theme-toggle-btn" id="themeToggleBtn" title="Toggle theme">
                    <span class="theme-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </span>
                </button>
                <a href="auth.html" class="btn-primary" id="loginBtn" style="text-decoration: none; padding: 0.5rem 1rem; font-size: 0.9rem;">
                    Login
                </a>
                <a href="settings.html" id="profilePictureBtn" class="profile-picture-header" style="display: none;">
                    <img id="headerProfilePicture" src="" alt="Profile" style="display: none;">
                    <span id="headerProfileInitial" style="display: none;"></span>
                </a>
            </div>
        </div>
    </header>
    

    <main>
        <!-- Controversial Questions Slideshow Section -->
        <section class="news-slideshow-section">
            <div class="news-slideshow" id="newsSlideshow">
                <!-- Questions slides will be dynamically added here -->
            </div>
        </section>

        <!-- Sponsored Section -->
        <section class="sponsored-section">
            <div class="container">
                <div class="sponsored-section-header">
                    <div class="sponsored-line"></div>
                    <span class="sponsored-label">Sponsored</span>
                    <div class="sponsored-line"></div>
                </div>
                <div class="sponsored-rooms-grid" id="sponsoredRoomsGrid">
                    <!-- Sponsored rooms will be added here -->
                </div>
                <div class="sponsored-section-footer">
                    <div class="sponsored-line"></div>
                </div>
            </div>
        </section>

        <!-- Active Rooms Section -->
        <section class="rooms-section">
            <div class="container">
                <div class="section-header-top">
                    <button class="start-conversation-btn" id="startDiscussionBtn">Start a conversation</button>
                </div>
                <!-- Category Sections (will be dynamically created) -->
                <div id="categorySections">
                    <!-- Category sections will be added here -->
                    <p style="text-align: center; color: var(--text-secondary); padding: 3rem;">Loading rooms...</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Create Conversation Form (No Modal) -->
    <div id="createConversationForm" class="create-conversation-form" style="display: none;">
        <form id="discussionForm">
            <!-- Step 1: Title -->
            <div class="conversation-step active" data-step="1">
                <div class="conversation-question">
                    <label>What's your conversation about?</label>
                </div>
                <div class="conversation-answer">
                    <input type="text" id="discussionTitle" name="title" placeholder="Enter a compelling title..." required>
                    <button type="button" class="nav-arrow nav-arrow-right" id="nextStepBtn1">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Step 2: Description -->
            <div class="conversation-step" data-step="2">
                <div class="conversation-question">
                    <label>Tell us more about it</label>
                </div>
                <div class="conversation-answer">
                    <textarea id="discussionDescription" name="description" placeholder="What's this discussion about?" rows="4" required></textarea>
                    <div class="answer-nav-buttons">
                        <button type="button" class="nav-arrow nav-arrow-left" id="prevStepBtn2">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="15 18 9 12 15 6"></polyline>
                            </svg>
                        </button>
                        <button type="button" class="nav-arrow nav-arrow-right" id="nextStepBtn2">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Category -->
            <div class="conversation-step" data-step="3">
                <div class="conversation-question">
                    <label>Choose a category <span style="font-weight: normal; color: var(--text-secondary);">(Optional)</span></label>
                </div>
                <div class="conversation-answer">
                    <select id="category" name="category">
                        <option value="">No category</option>
                        <option value="debate">Debate</option>
                        <option value="hot-takes">Hot Takes</option>
                        <option value="chilling">Chilling</option>
                        <option value="technology">Technology</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="science">Science</option>
                        <option value="politics">Politics</option>
                        <option value="sports">Sports</option>
                        <option value="lifestyle">Lifestyle</option>
                        <option value="education">Education</option>
                        <option value="gaming">Gaming</option>
                    </select>
                    <button type="button" class="nav-arrow nav-arrow-left" id="prevStepBtn3">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Pagination Dots -->
            <div class="conversation-pagination">
                <span class="pagination-dot active" data-step="1"></span>
                <span class="pagination-dot" data-step="2"></span>
                <span class="pagination-dot" data-step="3"></span>
            </div>

            <!-- Submit Button (only on last step) -->
            <div class="conversation-submit-container">
                <button type="submit" class="conversation-submit-btn" id="submitBtn" style="display: none;">Start your conversation</button>
            </div>
        </form>
    </div>


    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Inline Configuration (Safe for production - Supabase anon key is protected by RLS) -->
    <script>
        // Configuration - automatically works in both local and production environments
        const SUPABASE_URL = 'https://rtxpelmkxxownbafiwmz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0eHBlbG1reHhvd25iYWZpd216Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NTc5OTIsImV4cCI6MjA4MTQzMzk5Mn0.QKnVeBOaPYbkcSpm5zU2CtGa0uJ06z55Oas8Q-ShxZY';
        const LIVEKIT_URL = 'wss://speakersserver-0je4i45z.livekit.cloud';
        
        // Detect environment and set token server URL
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const TOKEN_SERVER_URL = isLocal ? 'http://localhost:3001' : window.location.origin + '/api/token';
        
        // Initialize Supabase client - make it globally accessible
        // Note: window.supabase is the library, we need to call createClient on it
        if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {
            // Store the library reference before we potentially overwrite window.supabase
            const supabaseLib = window.supabase;
            // Create the client and assign to global 'supabase' variable (var makes it global)
            var supabase = supabaseLib.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        } else {
            console.error('❌ Supabase library not loaded');
            var supabase = null; // Declare even if library failed to load
        }
        
        console.log('✅ Configuration loaded', { environment: isLocal ? 'local' : 'production' });
    </script>
    
    <!-- Donate Panel (slides in from right) -->
    <div class="donate-panel-overlay" id="donatePanelOverlay" style="display: none;">
        <div class="donate-panel" id="donatePanel">
            <div class="donate-panel-header">
                <h2>Support Speakers Server</h2>
                <button class="donate-panel-close" id="donatePanelClose">&times;</button>
            </div>
            
            <div class="donate-panel-content">
                <!-- Donation Form -->
                <div class="donate-form-section">
                    <h3>Make a Donation</h3>
                    <div class="donate-amount-group">
                        <label for="donateAmount">Amount (USD)</label>
                        <div class="donate-amount-input-wrapper">
                            <span class="donate-currency-display" id="donateAmountDisplay">$0</span>
                            <input type="text" id="donateAmount" class="donate-amount-input" placeholder="0" inputmode="numeric" pattern="[0-9]*" required autocomplete="off">
                        </div>
                        <div class="donate-quick-amounts">
                            <button type="button" class="donate-quick-btn" data-amount="10">$10</button>
                            <button type="button" class="donate-quick-btn" data-amount="50">$50</button>
                            <button type="button" class="donate-quick-btn" data-amount="100">$100</button>
                            <button type="button" class="donate-quick-btn" data-amount="500">$500</button>
                        </div>
                    </div>
                    <div class="donate-payment-info">
                        <p class="donate-info-text">Every cent helps to keep your voice heard</p>
                    </div>
                    <!-- Stripe Card Element -->
                    <div id="card-element" class="stripe-card-element">
                        <!-- Stripe Elements will create form elements here -->
                    </div>
                    <div id="card-errors" class="stripe-card-errors" role="alert"></div>
                    <button type="button" class="donate-submit-btn" id="donateSubmitBtn">Donate</button>
                </div>
                
                <!-- Top Donators Leaderboard -->
                <div class="donate-leaderboard-section">
                    <h3>Top Donators</h3>
                    <div class="donate-leaderboard" id="donateLeaderboard">
                        <p style="text-align: center; color: var(--text-secondary); padding: 1rem;">Loading...</p>
                    </div>
                </div>
                
                <!-- Recent Donations -->
                <div class="donate-recent-section">
                    <h3>Recent Donations</h3>
                    <div class="donate-recent-list" id="donateRecentList">
                        <p style="text-align: center; color: var(--text-secondary); padding: 1rem;">Loading...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-wrapper">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="about.html" class="footer-link">About the Creator</a>
                </div>
                <div class="footer-right">
                    <a href="mailto:speakersserver@gmail.com" class="footer-link">speakersserver@gmail.com</a>
                    <span class="footer-separator">•</span>
                    <a href="https://www.instagram.com/speakersserver" target="_blank" rel="noopener noreferrer" class="footer-link">Instagram</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Main Application Script -->
    <script src="script.js"></script>
</body>
</html>

