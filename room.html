<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room - Speakers Server</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="room.css">
    <link rel="stylesheet" href="animations.css">
</head>
<body>
    <div class="room-container">
        <!-- Main Content Area -->
        <main class="room-main">
            <!-- Room Header -->
            <header class="room-header" style="flex-shrink: 0;">
                <div class="room-info">
                    <h1 id="roomTitle">Room Title</h1>
                    <span class="room-category" id="roomCategory"></span>
                    <span class="room-role" id="roomRole">Participant</span>
                </div>
                <div class="room-controls">
                    <button class="theme-toggle-btn-room" id="themeToggleBtnRoom" title="Toggle theme">
                        <span class="theme-icon-room">ðŸŒ™</span>
                    </button>
                    
                    <!-- Participant controls -->
                    <button class="control-btn" id="raiseHandBtn" title="Raise Hand" style="display: none;">
                        <span>âœ‹</span> Raise Hand
                    </button>
                    
                    <!-- Speaker controls (when invited to speak) -->
                    <button class="control-btn" id="micBtn" title="Mute/Unmute" style="display: none;">
                        <span>ðŸŽ¤</span>
                    </button>
                    
                    <!-- Participants button (everyone can see) -->
                    <button class="control-btn" id="participantsBtn" title="View Participants">
                        <span>ðŸ‘¥</span> <span id="participantCount">0</span>
                    </button>
                    
                    <button class="control-btn" id="endMeetingBtn" title="End Meeting" style="display: none;">
                        <span>ðŸ”´</span> End Meeting
                    </button>
                    <button class="control-btn leave" id="leaveBtn" title="Leave Room">
                        <span>ðŸšª</span> Leave
                    </button>
                </div>
            </header>

            <!-- Main Content Area -->
            <div class="main-content-area" id="mainContentArea">
                <!-- Active Speakers Section (Top) -->
                <div class="active-speakers-section">
                    <div class="speakers-container" id="speakersContainer">
                        <!-- Active speaker tiles will be added here -->
                    </div>
                </div>

                <!-- Audience Section (Bottom) -->
                <div class="audience-section">
                    <div class="audience-header">
                        <h3>Audience â€” <span id="audienceCount">0</span></h3>
                        <input type="text" class="audience-search" placeholder="Search" id="audienceSearch">
                    </div>
                    <!-- Raised Hands Section -->
                    <div class="raised-hands-section" id="raisedHandsSection" style="display: none;">
                        <h4 class="raised-hands-title">Raised Hands â€” <span id="raisedHandsCount">0</span></h4>
                        <div class="raised-hands-list" id="raisedHandsList">
                            <!-- Raised hands will appear here -->
                        </div>
                    </div>
                    <!-- Regular Audience List -->
                    <div class="audience-list" id="audienceList">
                        <!-- Audience member tiles will be added here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Participants Panel (visible to everyone) -->
        <div class="participants-panel" id="participantsPanel" style="display: none;">
            <div class="panel-header">
                <h3>Participants</h3>
                <button class="close-panel" id="closePanelBtn">Ã—</button>
            </div>
            <div class="panel-tabs">
                <button class="panel-tab active" data-tab="all">All (<span id="allCount">0</span>)</button>
                <button class="panel-tab" data-tab="speakers">Speakers (<span id="speakersCount">0</span>)</button>
                <button class="panel-tab" data-tab="raised">Raised Hands (<span id="raisedCount">0</span>)</button>
            </div>
            <div class="panel-content" id="panelContent">
                <!-- Participants will be listed here -->
            </div>
        </div>

        <!-- Right Sidebar - Chat -->
        <aside class="chat-sidebar">
            <div class="sidebar-header">
                <h3>Chat</h3>
                <span class="chat-badge">Everyone can chat</span>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- Chat messages will appear here -->
            </div>
            <div class="chat-input-container" id="chatInputContainer">
                <input 
                    type="text" 
                    id="chatInput" 
                    placeholder="Type a message..."
                    autocomplete="off"
                >
                <button id="sendBtn" class="send-btn">Send</button>
            </div>
            <div class="chat-login-prompt" id="chatLoginPrompt" style="display: none;">
                <p style="text-align: center; padding: 1rem; color: var(--text-secondary);">
                    <a href="auth.html" style="color: var(--primary-color); text-decoration: underline;">Login</a> to join the chat
                </p>
            </div>
        </aside>
    </div>

    <!-- Participant Menu Modal -->
    <div id="participantMenuModal" class="participant-menu-modal">
        <div class="participant-menu-content">
            <div class="participant-menu-header">
                <h3 id="participantMenuName">Participant</h3>
                <button class="participant-menu-close" id="participantMenuClose">&times;</button>
            </div>
            <div class="participant-menu-options" id="participantMenuOptions">
                <!-- Options will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- LiveKit Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/livekit-client@2/dist/livekit-client.umd.min.js"></script>
    
    <!-- Inline Configuration (Safe for production - Supabase anon key is protected by RLS) -->
    <script>
        // Configuration - automatically works in both local and production environments
        const SUPABASE_URL = 'https://rtxpelmkxxownbafiwmz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0eHBlbG1reHhvd25iYWZpd216Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NTc5OTIsImV4cCI6MjA4MTQzMzk5Mn0.QKnVeBOaPYbkcSpm5zU2CtGa0uJ06z55Oas8Q-ShxZY';
        const LIVEKIT_URL = 'wss://speakersserver-0je4i45z.livekit.cloud';
        
        // Detect environment and set token server URL
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const TOKEN_SERVER_URL = isLocal ? 'http://localhost:3001' : window.location.origin + '/api/token';
        
        // Initialize Supabase client - check if already exists to avoid redeclaration
        function initializeSupabase() {
            // Check if supabase client already exists (from another page)
            if (typeof supabase !== 'undefined' && supabase !== null) {
                console.log('Reusing existing Supabase client');
                return supabase;
            }
            
            // Check if Supabase library is loaded
            if (typeof window.supabase === 'undefined' || !window.supabase.createClient) {
                console.warn('Supabase library not loaded yet, retrying...');
                setTimeout(initializeSupabase, 100);
                return null;
            }
            
            // Create the client
            var supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('âœ… Supabase client initialized');
            return supabase;
        }
        
        // Initialize immediately (will retry if library not ready)
        var supabase = initializeSupabase();
        
        console.log('âœ… Configuration loaded', { environment: isLocal ? 'local' : 'production' });
    </script>
    
    <!-- Room Script -->
    <script src="room.js"></script>
</body>
</html>

